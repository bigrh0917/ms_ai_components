# 知识库测试文档

本文档包含知识库功能的测试内容，用于验证RAG检索和问答功能。

## 1. 知识库功能介绍

知识库是一个基于本地文档的智能问答系统，名为"派聪明"。系统的主要功能包括：

### 核心功能

1. **文档查询**：可以查询知识库中已上传的文档内容
2. **智能问答**：基于知识库内容回答用户问题
3. **引用来源**：提供相关文档的引用来源，方便用户查阅原文

### 使用场景

- 企业内部知识管理
- 技术文档查询
- 政策法规咨询
- 产品使用指南查询

### 技术特点

- 基于向量检索的语义理解
- 混合检索（向量+关键词）
- 多轮对话支持
- 权限控制机制

---

## 2. 知识库支持的文件格式

知识库系统支持多种常见的文档格式，方便用户上传不同类型的文档。

### 文档格式列表

#### 办公文档
- **PDF** (.pdf) - 便携式文档格式，支持文本和图片
- **Word** (.doc, .docx) - Microsoft Word文档
- **Excel** (.xls, .xlsx) - Microsoft Excel电子表格
- **PowerPoint** (.ppt, .pptx) - Microsoft PowerPoint演示文稿

#### 文本格式
- **纯文本** (.txt) - 纯文本文件
- **Markdown** (.md) - Markdown格式文档

#### 其他格式
- **图片文件** - 支持OCR识别，可从图片中提取文字内容
- **其他常见办公文档** - 根据系统配置支持更多格式

### 文件处理流程

上传的文件会自动进行以下处理：

1. **文件解析**：提取文档中的文本内容
2. **分块处理**：将文档分割成适合检索的文本块
3. **向量化**：为每个文本块生成向量表示
4. **建立索引**：在Elasticsearch中建立索引，方便后续检索

整个过程可能需要几分钟时间，具体取决于文件大小和复杂度。

---

## 3. 如何上传文件到知识库

上传文件到知识库的完整步骤如下：

### 步骤一：准备文件

确保文件满足以下要求：
- 文件格式支持（参考上述支持格式列表）
- 文件内容清晰可读
- 文件大小在系统限制范围内

### 步骤二：访问上传接口

可以通过以下方式上传文件：
- 使用文件上传API接口
- 通过Web界面上传
- 使用批量上传功能

### 步骤三：选择文件

选择要上传的文档文件，可以一次选择多个文件进行批量上传。

### 步骤四：设置权限

上传时可以设置文档的可见性：
- **公开文档**：所有用户都可以访问
- **私有文档**：只有文档所有者可以访问
- **组织标签**：可以设置文档所属的组织标签，只有拥有相应标签的用户可以访问

### 步骤五：等待处理

系统会自动进行以下处理：
- 文件解析和文本提取
- 文档分块处理
- 向量化处理
- 建立检索索引

### 步骤六：完成上传

处理完成后，文档就可以被检索和查询了。系统会显示处理状态和结果。

### 注意事项

- 上传后系统会自动提取文本内容
- 进行分块处理，每个文本块大小适中
- 生成向量索引，支持语义检索
- 整个过程可能需要几分钟时间

---

## 4. 检索结果排序机制

检索结果采用混合检索（Hybrid Search）方式，结合了向量检索和关键词检索，确保检索结果的准确性和相关性。

### 排序因素

检索结果的排序主要考虑以下因素：

#### 1. 相关性得分

综合以下多个维度的得分：
- **向量相似度**：基于语义相似度计算，理解问题的意图
- **关键词匹配度**：基于精确匹配，确保关键信息不遗漏
- **综合得分**：将向量相似度和关键词匹配度进行加权融合

#### 2. 文档质量

考虑文档的完整性和质量：
- 文档完整性：完整文档优先显示
- 内容质量：内容丰富的文档优先
- 更新频率：最新更新的文档可能获得更高权重

#### 3. 时间因素

- 较新的文档可能获得更高权重
- 根据文档创建或更新时间进行排序调整

### 检索方式

#### 向量检索

- **原理**：基于语义相似度，理解问题的意图
- **优势**：能够理解同义词、近义词，进行语义匹配
- **应用**：处理自然语言问题，理解用户意图

#### 关键词检索

- **原理**：基于精确匹配，确保关键信息不遗漏
- **优势**：精确匹配关键词，不遗漏重要信息
- **应用**：处理专业术语、特定名称等精确查询

### 排序算法

最终结果会按照综合得分从高到低排序，确保最相关的内容排在前面。

综合得分计算公式：
```
综合得分 = α × 向量相似度得分 + β × 关键词匹配得分 + γ × 质量得分 + δ × 时间权重
```

其中：
- α, β, γ, δ 是权重系数，可以根据实际需求调整
- 得分范围通常在0-1之间
- 得分越高，排序越靠前

### 优化建议

为了获得更好的检索效果，建议：
1. 使用清晰、具体的问题描述
2. 包含关键术语和关键词
3. 避免过于宽泛的问题
4. 参考系统提供的相关文档建议

---

## 附录：系统配置说明

### 向量模型

系统使用 OpenAI 的 `text-embedding-3-small` 模型进行向量化：
- 向量维度：1536
- 支持多语言
- 高精度语义理解

### 检索参数

- Top-K 结果数：默认返回前5个最相关结果
- 相似度阈值：可配置最小相似度阈值
- 检索范围：支持按组织标签、权限范围限制检索

### 性能优化

- 索引优化：定期优化Elasticsearch索引
- 缓存机制：常用查询结果缓存
- 异步处理：文件上传和处理采用异步方式

---

**文档版本**：v1.0  
**最后更新**：2025-01-26  
**维护者**：系统管理员

